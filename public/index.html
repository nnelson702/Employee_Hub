<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sales Forecasting</title>

  <!-- Supabase (UMD) -->
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>

  <!-- Inline config -->
  <script>
    window.APP_CONFIG = {
      SUPABASE_URL: "https://bvyrxqfffaxthrjfxjue.supabase.co",
      SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ2eXJ4cWZmZmF4dGhyamZ4anVlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMDkwMjEsImV4cCI6MjA3NzY4NTAyMX0.BK3LvTsDdLgFn5qNFHQoa4MTkGIe5sNvmVaA8uujvnM"
    };
  </script>

  <link rel="stylesheet" href="./styles.css?v=2025-12-02-02" />
  <script defer src="./app.js?v=2025-12-06-01"></script>
</head>
<body>
  <header class="appbar">
    <h1>Sales Forecasting</h1>
    <div class="authbox">
      <span id="whoami"></span>
      <button id="btn-signout" class="secondary hidden">Sign out</button>
    </div>
  </header>

  <!-- Nav -->
  <nav id="topNav" class="nav hidden">
    <button data-route="home">Home</button>
    <button data-route="sales">Sales Goals & Current Results</button>
    <button data-route="pl">P&L</button>
    <button data-route="deptwalk">Dept Walk</button>
    <button data-route="deptwalk-results">Dept Walk Results & Details</button>
    <button data-route="b2b">B2B</button>
    <button data-route="eir">EIR – Incident Reports</button>
    <button id="nav-admin" data-route="admin" class="admin-only hidden">Admin</button>
  </nav>

  <!-- Status bar -->
  <div id="status" class="status">Loading…</div>

  <!-- Logged-out simple auth -->
  <section id="logged-out" class="container">
    <div id="auth-area">
      <input id="email" type="email" placeholder="Email" />
      <input id="password" type="password" placeholder="Password" />

      <div class="auth-actions">
        <button id="btn-signin">Sign in</button>
        <button id="btn-forgot" type="button" class="link-button">
          Forgot password?
        </button>
      </div>

      <div id="auth-message" class="auth-message"></div>
    </div>
  </section>

  <!-- Pages -->
  <main>

    <!-- Home (stub) -->
    <section id="page-home" class="page hidden">
      <div class="container">
        <h2>Welcome</h2>
        <p>This will become a simple landing page with links, tips, and quick KPIs.</p>
      </div>
    </section>

    <!-- Sales (calendar app) -->
    <section id="page-sales" class="page hidden">
      <div id="app" class="container">
        <div class="controls">
          <label>Store
            <select id="storeSelect"></select>
          </label>
          <label>Month
            <input id="monthInput" type="month" />
          </label>
          <div>
            <button id="btn-load">Load</button>
          </div>
        </div>

        <!-- Admin-only tools for daily planner -->
        <div id="admin-daily-toolbar" class="row hidden">
          <button id="btn-open-planner" class="secondary">
            Daily Goal Planner
          </button>
        </div>

        <div id="summary" class="summary">—</div>
        <div id="calendar" class="calendar"></div>
      </div>
    </section>

    <!-- P&L (stub) -->
    <section id="page-pl" class="page hidden">
      <div class="container">
        <h2>P&L (Coming Soon)</h2>
        <p>We’ll render monthly P&L snapshots, variance, and drill-ins here.</p>
      </div>
    </section>

    <!-- Dept Walk (stub) -->
    <section id="page-deptwalk" class="page hidden">
      <div class="container">
        <h2>Dept Walk (Coming Soon)</h2>
        <p>Mobile-friendly capture + scoring will land here.</p>
      </div>
    </section>

    <!-- Dept Walk Results (stub) -->
    <section id="page-deptwalk-results" class="page hidden">
      <div class="container">
        <h2>Dept Walk Results & Details (Coming Soon)</h2>
      </div>
    </section>

    <!-- B2B (stub) -->
    <section id="page-b2b" class="page hidden">
      <div class="container">
        <h2>B2B (Coming Soon)</h2>
        <p>This space will support outside sales, in-store B2B tools, and reporting.</p>
      </div>
    </section>

    <!-- EIR (stub) -->
    <section id="page-eir" class="page hidden">
      <div class="container">
        <h2>Employee Incident Reports (Coming Soon)</h2>
        <p>Employees will be able to document issues, route them by type, and track follow-up status.</p>
      </div>
    </section>

    <!-- Admin -->
    <section id="page-admin" class="page hidden">
      <div class="container">
        <h2>Admin</h2>

        <div class="admin-grid">
          <!-- Users / Admin toggle -->
          <div class="card">
            <h3>Users</h3>
            <div class="row">
              <input id="admin-user-search" placeholder="Search email…" />
              <button id="btn-refresh-users" class="secondary">Refresh</button>
            </div>
            <table id="tbl-users" class="table">
              <thead>
                <tr>
                  <th>Email</th>
                  <th>Admin?</th>
                  <th>User Id</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody><!-- filled by JS --></tbody>
            </table>
          </div>

          <!-- Store access mapping -->
          <div class="card">
            <h3>Store Access</h3>
            <div class="row">
              <label>User
                <select id="sa-userSelect"></select>
              </label>
              <label>Store
                <select id="sa-storeSelect"></select>
              </label>
              <button id="btn-add-access">Grant access</button>
            </div>
            <table id="tbl-access" class="table">
              <thead>
                <tr>
                  <th>Store</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody><!-- filled by JS --></tbody>
            </table>
          </div>

          <!-- Monthly goals -->
          <div class="card">
            <h3>Monthly Goals</h3>
            <div class="row">
              <label>Store
                <select id="mg-storeSelect"></select>
              </label>
              <label>Month
                <input id="mg-monthInput" type="month" />
              </label>
              <button id="btn-load-goals" class="secondary">Load</button>
            </div>
            <div class="row">
              <label>Sales Goal ($)
                <input id="mg-sales" type="number" step="0.01" />
              </label>
              <label>Txn Goal
                <input id="mg-txn" type="number" step="1" />
              </label>
              <label>ATV Goal ($)
                <input id="mg-atv" type="number" step="0.01" />
              </label>
              <button id="btn-save-goals">Save Goals</button>
            </div>
            <div id="mg-status" class="microstatus">—</div>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- Password reset view -->
  <section id="password-reset" class="container hidden">
    <h2>Set a new password</h2>
    <p>Enter a new password for your account.</p>

    <input id="newPassword" type="password" placeholder="New password" />
    <input id="confirmPassword" type="password" placeholder="Confirm new password" />

    <button id="btn-set-password">Update password</button>

    <div id="reset-message" class="auth-message"></div>
  </section>

  <!-- Daily Planner Modal -->
  <div id="dailyPlannerModal" class="modal hidden" aria-hidden="true">
    <div class="sheet">
      <header>
        <h2 id="plannerTitle" style="margin:0">Daily Goal Planner</h2>
        <button id="btn-planner-close" class="close small">Close</button>
      </header>
      <div id="dailyPlannerContent"></div>
      <div class="actions">
        <button id="btn-planner-reset" class="secondary">Reset to equal days</button>
        <button id="btn-planner-recalc" class="secondary">Recalculate suggestions</button>
        <button id="btn-planner-save" class="save">Save & Apply</button>
      </div>
      <div id="planner-status" class="microstatus"></div>
    </div>
  </div>

  <!-- Day modal (unchanged) -->
  <div id="dayModal" class="modal hidden" aria-hidden="true">
    <div class="sheet">
      <header>
        <h2 id="modalTitle" style="margin:0"></h2>
        <span id="modalBadge" class="badge">—</span>
        <button id="btn-clear-all" class="secondary small">Clear all</button>
      </header>
      <div id="modalKpis"></div>
      <div class="actions">
        <button id="btnCloseModal" class="close">Close</button>
        <button id="btnSaveModal" class="save">Save</button>
      </div>
    </div>
  </div>
</body>
</html>
